<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>文章分类</title>
	</head>
	<body>
		<canvas id="canvas" width="400" height="400">不支持此浏览器</canvas>
		<input type="file" id="fileSelector" />
		<input type="button" id="b" value="import" onclick="if(fileSelector.value==''){alert('请选择xls文件');}else{importXLS();cover();}" />
		
		<script language="javascript" type="text/javascript">
		var articles = [];
		var ctx = document.getElementById('canvas').getContext('2d');
		var allPoints = [];
		function importXLS(){
			var file = document.getElementById('fileSelector');
			console.log(window.URL.createObjectURL(file.files[0]));
			objCon = new ActiveXObject("ADODB.Connection");
			objCon.Provider = "Microsoft.Ace.OleDb.12.0;";
			objCon.ConnectionString = "Data Source=" + file.value + ";Extended Properties=Excel 12.0;";
			objCon.CursorLocation = 1;
			objCon.Open;
			var strQuery;
			//Get the SheetName
			var strSheetName = "Sheet1$";
			var rsTemp = new ActiveXObject("ADODB.Recordset");
			rsTemp = objCon.OpenSchema(20);
			if(!rsTemp.EOF)
			strSheetName = rsTemp.Fields("Table_Name").Value;
			rsTemp = null;
			rsExcel =   new ActiveXObject("ADODB.Recordset");
			strQuery = "SELECT * FROM [" + strSheetName + "]";
			rsExcel.ActiveConnection = objCon;
			rsExcel.Open(strQuery);
			var index = 0;
			while(!rsExcel.EOF){
				articles[index] = {
					name:'rsExcel.Fields(0).value',
					school:'rsExcel.Fields(1).value',
					cellphone:'rsExcel.Fields(2).value',
					title:'rsExcel.Fields(3).value',
					xuanti:rsExcel.Fields(4).value,
					keguan:rsExcel.Fields(5).value,
					shidai:rsExcel.Fields(6).value,
					wenbi:rsExcel.Fields(7).value,
					gushi:rsExcel.Fields(8).value,
					sixiang:rsExcel.Fields(9).value
				}
				index++;
				rsExcel.MoveNext; 
			}
			alert('导入成功');
			// Close the connection and dispose the file
			objCon.Close;
			objCon =null;
			rsExcel = null;
		}

		//传入canvas的宽度和高度还有六边形的边长，就可以确定一个六边形的六个点的坐标了
		function getHexagonPoints(width, height, edgeLength){
			var paramX = edgeLength * Math.sqrt(3) / 2;
			var marginLeft = (width - 2 * paramX) / 2;
			var x5 = x6 = marginLeft;
			var x2 = x3 = marginLeft + paramX * 2;
			var x1 = x4 = marginLeft + paramX;

			var paramY = edgeLength / 2;
			var marginTop = (height - 4 * paramY) / 2;
			var y1 = marginTop;
			var y2 = y6 = marginTop + paramY;
			var y3 = y5 = marginTop + 3 * paramY;
			var y4 = marginTop + 4 * paramY;

			var points = new Array();
			points[0] = [x1, y1];
			points[1] = [x2, y2];
			points[2] = [x3, y3];
			points[3] = [x4, y4];
			points[4] = [x5, y5];
			points[5] = [x6, y6];
			return points;
		}

		function cover(){
		
		 
		//画七个六边形
		function drawHexagon(sixParam) 
		{
			for (var i = 0; i < 7; i++) {
				allPoints[i] = getHexagonPoints(400, 400, i * sixParam / 6);
				ctx.beginPath();
				ctx.fillStyle = "rgba(0,0,0,0.2)";
				ctx.moveTo(allPoints[i][5][0],allPoints[i][5][1]); //5
				for (var j = 0; j < 6; j++) {
			    ctx.lineTo(allPoints[i][j][0],allPoints[i][j][1]); //1
				}
				ctx.stroke();
				ctx.closePath();
				ctx.fill();
			}
		}
		 
		//画交叉的线
		function drawLines() 
		{
			ctx.beginPath();
			for (var i = 0; i < 3; i++) {
				ctx.moveTo(allPoints[0][i][0],allPoints[0][i][1]); //1-4
				ctx.lineTo(allPoints[0][i+3][0],allPoints[0][i+3][1]); //1-4
				ctx.stroke();
			}
			ctx.closePath();
		}
		 
		//画覆盖物
		function drawCover(){
			ctx.beginPath();
			ctx.fillStyle = "rgba(50,188,125,0.5)";
			ctx.moveTo(coverPoints[5][0],coverPoints[5][1]); //5
			for (var j = 0; j < 6; j++) {
				ctx.lineTo(coverPoints[j][0],coverPoints[j][1]);
			}
			ctx.stroke();
			ctx.closePath();
			ctx.fill();
		}
		
			drawHexagon(200); 
			drawLines();
			//初始化覆盖物
			var coverPoints = [];
			for(var j = 0;j<articles.length;j++){
				coverPoints[0] = allPoints[articles[j]['xuanti']][0];
				coverPoints[1] = allPoints[articles[j]['keguan']][1];
				coverPoints[2] = allPoints[articles[j]['shidai']][2];
				coverPoints[3] = allPoints[articles[j]['wenbi']][3];
				coverPoints[4] = allPoints[articles[j]['gushi']][4];
				coverPoints[5] = allPoints[articles[j]['sixiang']][5];
				drawCover();
			}
		}
			
		
		</script>
	</body>
</html>